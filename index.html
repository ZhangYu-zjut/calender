<html><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y2KËí∏Ê±ΩÊ≥¢ÊúàÁªèÊó•ÂéÜ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #3a1c71 0%, #d76d77 50%, #ffaf7b 100%);
            font-family: 'MS Sans Serif', 'Tahoma', 'Arial', sans-serif;
            padding: 20px;
        }
        
        .calendar-container {
            width: 280px;
            height: 320px;
            background: linear-gradient(145deg, #7a6f9d, #5d4c7e);
            border-radius: 12px;
            padding: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 10px 20px rgba(0, 0, 0, 0.5),
                inset 0 0 40px rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* CRTÊâ´ÊèèÁ∫øÊïàÊûú */
        .crt-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                rgba(0, 0, 0, 0.1) 50%
            );
            background-size: 100% 3px;
            pointer-events: none;
            z-index: 1;
            opacity: 0.3;
        }
        
        /* Ê≥¢ÁÇπËÉåÊôØ */
        .dot-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(white 15%, transparent 16%),
                radial-gradient(white 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            opacity: 0.1;
            z-index: 0;
        }
        
        /* Ë£ÖÈ•∞ÊÄßËæπÊ°Ü */
        .border-decoration {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }
        
        .border-decoration::before,
        .border-decoration::after {
            content: "";
            position: absolute;
            background: linear-gradient(45deg, #ff69b4, #00ffff, #ff69b4);
            opacity: 0.3;
        }
        
        .border-decoration::before {
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(to right, transparent, #ff69b4, #00ffff, #ff69b4, transparent);
        }
        
        .border-decoration::after {
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(to right, transparent, #00ffff, #ff69b4, #00ffff, transparent);
        }
        
        /* Ëù¥Ëù∂ÁªìË£ÖÈ•∞ */
        .bow {
            position: absolute;
            width: 50px;
            height: 25px;
            background: linear-gradient(45deg, #fff0f5, #f8f0ff, #fff0f5);
            border-radius: 50% 50% 0 0;
            z-index: 3;
            filter: blur(0.5px);
            box-shadow: 
                0 2px 4px rgba(0,0,0,0.2),
                inset 0 0 8px rgba(255,255,255,0.4);
        }
        
        .bow-left {
            top: 8px;
            left: 8px;
            transform: rotate(-15deg);
        }
        
        .bow-right {
            top: 8px;
            right: 8px;
            transform: rotate(15deg);
        }
        
        .bow-center {
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            width: 15px;
            height: 12px;
            background: linear-gradient(45deg, #fff0f5, #f8f0ff);
            border-radius: 50%;
            z-index: 4;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        /* ÁèçÁè†Ë£ÖÈ•∞ */
        .pearl {
            position: absolute;
            background: radial-gradient(circle at 30% 30%, #ffffff, #f0f0f0 40%, #d8d8d8 70%, #a0a0a0);
            border-radius: 50%;
            z-index: 4;
            box-shadow: 
                inset -1px -1px 2px rgba(0,0,0,0.2),
                0 2px 4px rgba(255,255,255,0.8),
                0 0 8px rgba(255,255,255,0.4);
        }
        
        .pearl-1 { top: 20px; left: 35px; width: 8px; height: 8px; }
        .pearl-2 { top: 45px; right: 30px; width: 7px; height: 7px; }
        .pearl-3 { bottom: 25px; left: 40px; width: 9px; height: 9px; }
        .pearl-4 { bottom: 15px; right: 35px; width: 6px; height: 6px; }
        
        /* Ëí∏Ê±ΩÊ≥¢È£éÊ†ºÊñáÂ≠ó */
        .vaporwave-text {
            position: absolute;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.7);
            writing-mode: vertical-lr;
            text-shadow: 
                0 0 5px rgba(255, 105, 180, 0.9),
                0 0 8px rgba(0, 255, 255, 0.7),
                0 0 12px rgba(255, 105, 180, 0.5);
            z-index: 0;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .vaporwave-left {
            left: 5px;
            top: 60px;
            transform: rotate(180deg);
        }
        
        .vaporwave-right {
            right: 5px;
            top: 60px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: white;
            position: relative;
            z-index: 5;
        }
        
        .nav-btn {
            width: 32px;
            height: 32px;
            background: linear-gradient(145deg, #c0c0c0, #e0e0e0);
            border: none;
            border-radius: 6px;
            color: #5d4c7e;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            position: relative;
            z-index: 5;
            font-family: 'Courier New', monospace;
            transition: all 0.2s;
            box-shadow: 
                0 4px 0 #a0a0a0,
                0 6px 8px rgba(0,0,0,0.3),
                inset 2px 2px 4px rgba(255,255,255,0.8);
        }
        
        .nav-btn:hover {
            transform: translateY(2px);
            box-shadow: 
                0 2px 0 #a0a0a0,
                0 4px 6px rgba(0,0,0,0.3),
                inset 2px 2px 4px rgba(255,255,255,0.8);
        }
        
        .nav-btn:active {
            transform: translateY(4px);
            box-shadow: 
                0 0 0 #a0a0a0,
                0 2px 4px rgba(0,0,0,0.3),
                inset 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .month-title {
            font-size: 16px;
            font-weight: bold;
            color: white;
            text-shadow: 
                0 0 5px #ff00ff,
                0 0 8px #00ffff,
                0 2px 3px rgba(0,0,0,0.5);
            letter-spacing: 1px;
        }
        
        .weekdays {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            position: relative;
            z-index: 5;
        }
        
        .weekday {
            width: 14.28%;
            text-align: center;
            color: #f0e6ff;
            font-size: 11px;
            font-weight: bold;
            padding: 6px 0;
            text-shadow: 0 1px 2px rgba(0,0,0,0.4);
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .days-grid {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
            position: relative;
            z-index: 5;
        }
        
        .day-cell {
            width: 14.28%;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            cursor: pointer;
            border-radius: 4px;
            margin-bottom: 2px;
            position: relative;
            transition: all 0.3s;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.4);
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .day-cell:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }
        
        .today {
            background-color: rgba(255, 255, 255, 0.4);
            box-shadow: 
                0 0 10px rgba(255, 255, 255, 0.8),
                inset 0 0 8px rgba(255, 255, 255, 0.3);
            font-weight: bold;
        }
        
        .period {
            background: rgba(255, 105, 180, 0.4);
            position: relative;
        }
        
        .period::after {
            content: "‚òÖ";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: rgba(255, 255, 255, 0.7);
            z-index: 1;
            text-shadow: 
                0 0 5px rgba(255,255,255,0.8),
                0 0 10px rgba(255,255,255,0.4);
        }
        
        .period .day-number {
            position: relative;
            z-index: 2;
            color: white;
            font-weight: bold;
            font-size: 11px;
        }
        
        .period-start {
            position: relative;
        }
        
        .period-start::before {
            content: "‚ú¶";
            position: absolute;
            top: -2px;
            right: -2px;
            font-size: 10px;
            color: #ff69b4;
            text-shadow: 0 0 5px rgba(255, 105, 180, 0.8);
            z-index: 3;
        }
        
        .predicted {
            position: relative;
        }
        
        .predicted::before {
            content: "‚ô°";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 26px;
            color: rgba(255, 105, 180, 0.5);
            z-index: 1;
            text-shadow: 
                0 0 6px rgba(255, 105, 180, 0.4),
                0 0 12px rgba(255, 105, 180, 0.2);
        }
        
        .predicted .day-number {
            position: relative;
            z-index: 2;
            color: #ff69b4;
            font-weight: bold;
            font-size: 11px;
        }
        
        .other-month {
            opacity: 0.5;
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .info-bar {
            display: flex;
            justify-content: space-between;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.3);
            color: #d0c0ff;
            font-size: 10px;
            position: relative;
            z-index: 5;
        }
        
        .period-length {
            color: #ff69b4;
            cursor: pointer;
            font-weight: bold;
            text-shadow: 0 0 4px rgba(255, 105, 180, 0.5);
        }
        
        /* ÂØπËØùÊ°ÜÁæéÂåñ */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            display: none;
        }
        
        .dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, rgba(125, 107, 142, 0.95), rgba(93, 76, 126, 0.95));
            border-radius: 12px;
            padding: 20px;
            box-shadow: 
                0 10px 25px rgba(0,0,0,0.6),
                0 0 15px rgba(255, 105, 180, 0.4),
                0 0 30px rgba(0, 255, 255, 0.3);
            z-index: 1001;
            display: none;
            border: 2px solid rgba(255, 255, 255, 0.3);
            min-width: 220px;
        }
        
        .dialog::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(to right, transparent, #ff69b4, #00ffff, #ff69b4, transparent);
        }
        
        .dialog.active {
            display: block;
        }
        
        .dialog-title {
            font-size: 14px;
            color: #ff69b4;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0 0 6px rgba(255, 105, 180, 0.7);
            letter-spacing: 1px;
        }
        
        .dialog-option {
            padding: 10px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 12px;
            color: white;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dialog-option:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateX(5px);
            box-shadow: 0 0 10px rgba(255, 105, 180, 0.3);
        }
        
        .dialog-option.delete {
            background: rgba(255, 100, 100, 0.3);
            color: #ffcccc;
        }
        
        .dialog-option.delete:hover {
            background: rgba(255, 100, 100, 0.4);
        }
        
        .dialog-buttons {
            display: flex;
            justify-content: center;
            margin-top: 15px;
        }
        
        .dialog-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            margin: 0 8px;
            background: linear-gradient(145deg, #ff69b4, #ff1493);
            color: white;
            transition: all 0.3s;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        
        .dialog-btn.cancel {
            background: linear-gradient(145deg, #888888, #666666);
            color: #eeeeee;
        }
        
        .dialog-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        
        .dialog-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        /* Ê∂àÊÅØÊèêÁ§∫ÁæéÂåñ */
        .message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            color: #ff69b4;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 1002;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 
                0 0 15px rgba(255, 105, 180, 0.6),
                0 0 30px rgba(0, 255, 255, 0.4);
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-shadow: 0 0 5px rgba(255, 105, 180, 0.8);
            letter-spacing: 0.5px;
        }
        
        /* Ê∑ªÂä†‰∏Ä‰∫õÊµÆÂä®Á≤íÂ≠êÊïàÊûú */
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }
        
        @keyframes float {
            0% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 0.3; }
            90% { opacity: 0.3; }
            100% { transform: translateY(-100px) translateX(50px); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="calendar-container">
        <!-- ËÉåÊôØÊïàÊûú -->
        <div class="dot-pattern"></div>
        <div class="crt-effect"></div>
        <div class="border-decoration"></div>
        
        <!-- Ë£ÖÈ•∞ÂÖÉÁ¥† -->
        <div class="bow bow-left"></div>
        <div class="bow bow-right"></div>
        <div class="bow-center"></div>
        
        <!-- ÁèçÁè†Ë£ÖÈ•∞ -->
        <div class="pearl pearl-1"></div>
        <div class="pearl pearl-2"></div>
        <div class="pearl pearl-3"></div>
        <div class="pearl pearl-4"></div>
        
        <!-- Ëí∏Ê±ΩÊ≥¢ÊñáÂ≠ó -->
        <div class="vaporwave-text vaporwave-left">‚ãÜ.Àöñ¶π‚ãÜ‚úÆ‚ãÜ.Àö</div>
        <div class="vaporwave-text vaporwave-right">Àñ÷¥ ñ§êêôö‚äπ‚Çä‚ãÜ‚òÜ</div>
        
        <!-- ÊµÆÂä®Á≤íÂ≠ê -->
        <div class="particles" id="particles"></div>
        
        <!-- Êó•ÂéÜÂÜÖÂÆπ -->
        <div class="header">
            <button class="nav-btn" onclick="changeMonth(-1)">‚Äπ</button>
            <div class="month-title" id="month-year">2024Âπ¥1Êúà</div>
            <button class="nav-btn" onclick="changeMonth(1)">‚Ä∫</button>
        </div>
        
        <div class="weekdays">
            <div class="weekday">Êó•</div>
            <div class="weekday">‰∏Ä</div>
            <div class="weekday">‰∫å</div>
            <div class="weekday">‰∏â</div>
            <div class="weekday">Âõõ</div>
            <div class="weekday">‰∫î</div>
            <div class="weekday">ÂÖ≠</div>
        </div>
        
        <div class="days-grid" id="days-grid"></div>
        
        <div class="info-bar">
            <div>Âë®Êúü: <span id="avg-cycle">28</span>Â§© | ËÆ∞ÂΩï: <span id="record-count">0</span>Ê¨°</div>
            <div>ÁªèÊúü: <span class="period-length" onclick="showAdjustDialog()" id="period-length">7</span>Â§©</div>
        </div>
    </div>
    
    <!-- Ê∂àÊÅØÊèêÁ§∫ -->
    <div class="message" id="message"></div>
    
    <!-- ÁºñËæëÂØπËØùÊ°Ü -->
    <div class="dialog-overlay" id="dialog-overlay"></div>
    <div class="dialog" id="edit-dialog">
        <div class="dialog-title" id="dialog-title">ÈÄâÊã©Êìç‰Ωú</div>
        <div class="dialog-option" id="set-start-option" onclick="setPeriodStart()">ËÆæ‰∏∫ÊúàÁªèÂºÄÂßãÊó• (7Â§©Âë®Êúü)</div>
        <div class="dialog-option" id="toggle-single-option" onclick="toggleSingleDay()">Ê†áËÆ∞/ÂèñÊ∂àÊ†áËÆ∞ÂçïÊó•</div>
        <div class="dialog-option delete" id="delete-option" onclick="deletePeriod()">Âà†Èô§Êï¥‰∏™Âë®Êúü</div>
        <div class="dialog-buttons">
            <button class="dialog-btn cancel" onclick="closeDialog()">ÂèñÊ∂à</button>
        </div>
    </div>
    
    <!-- Âë®ÊúüË∞ÉÊï¥ÂØπËØùÊ°Ü -->
    <div class="dialog" id="adjust-dialog">
        <div class="dialog-title">Ë∞ÉÊï¥ÁªèÊúüÂ§©Êï∞</div>
        <div style="text-align: center; margin: 15px 0; font-size: 12px; color: white;">
            ÂΩìÂâçËÆæÁΩÆ: <span id="current-length">7</span>Â§©
        </div>
        <div style="display: flex; align-items: center; justify-content: center; margin: 15px 0;">
            <button class="nav-btn" onclick="changePeriodLength(-1)" style="margin-right: 20px;">-</button>
            <span style="font-size: 18px; font-weight: bold; min-width: 40px; color: #ff69b4;" id="adjust-length">7</span>
            <button class="nav-btn" onclick="changePeriodLength(1)" style="margin-left: 20px;">+</button>
        </div>
        <div class="dialog-buttons">
            <button class="dialog-btn" onclick="savePeriodLength()">Á°ÆÂÆö</button>
            <button class="dialog-btn cancel" onclick="closeAdjustDialog()">ÂèñÊ∂à</button>
        </div>
    </div>

    <script>
        // ÊúàÁªèÊó•ÂéÜÁ≥ªÁªü
        let currentDate = new Date();
        let periods = [];
        let periodLength = 7;
        let selectedDate = null;
        let selectedCycle = null;
        
        // ÂàùÂßãÂåñ
        window.onload = function() {
            console.log('Êó•ÂéÜÂàùÂßãÂåñÂºÄÂßã...');
            loadData();
            updateCalendar();
            createParticles();
            console.log('Êó•ÂéÜÂàùÂßãÂåñÂÆåÊàê');
        };
        
        // ÂàõÂª∫ÊµÆÂä®Á≤íÂ≠ê
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const colors = [
                'rgba(255, 105, 180, 0.3)',
                'rgba(0, 255, 255, 0.3)',
                'rgba(255, 255, 255, 0.3)',
                'rgba(255, 20, 147, 0.3)'
            ];
            
            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // ÈöèÊú∫Â§ßÂ∞è
                const size = Math.random() * 4 + 1;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                // ÈöèÊú∫È¢úËâ≤
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                // ÈöèÊú∫‰ΩçÁΩÆ
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                
                // ÈöèÊú∫Âä®ÁîªÂª∂Ëøü
                particle.style.animationDelay = Math.random() * 20 + 's';
                
                particlesContainer.appendChild(particle);
            }
        }
        
        // Êï∞ÊçÆÊìç‰Ωú
        function loadData() {
            const saved = localStorage.getItem('period-calendar');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    periods = data.periods || [];
                    periodLength = data.periodLength || 7;
                    updateInfo();
                } catch(e) {
                    periods = [];
                    periodLength = 7;
                }
            }
        }
        
        function saveData() {
            const data = {
                periods: periods,
                periodLength: periodLength,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('period-calendar', JSON.stringify(data));
        }
        
        // Êõ¥Êñ∞Êó•ÂéÜ
        function updateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Êõ¥Êñ∞Êúà‰ªΩÊ†áÈ¢ò
            const monthNames = ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà', 
                               '7Êúà', '8Êúà', '9Êúà', '10Êúà', '11Êúà', '12Êúà'];
            document.getElementById('month-year').textContent = 
                year + 'Âπ¥' + monthNames[month];
            
            // Ê∏ÖÁ©∫Êó•ÊúüÁΩëÊ†º
            const daysGrid = document.getElementById('days-grid');
            daysGrid.innerHTML = '';
            
            // Ëé∑ÂèñÂΩìÊúà‰ø°ÊÅØ
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const firstDayOfWeek = firstDay.getDay();
            
            // Ê∑ªÂä†‰∏ä‰∏™ÊúàÁöÑÊó•Êúü
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const day = prevMonthLastDay - i;
                const date = new Date(year, month - 1, day);
                createDayCell(date, day, true);
            }
            
            // Ê∑ªÂä†ÂΩìÊúàÊó•Êúü
            const today = new Date();
            const todayStr = formatDate(today);
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const isToday = formatDate(date) === todayStr;
                createDayCell(date, day, false, isToday);
            }
            
            // Ê∑ªÂä†‰∏ã‰∏™ÊúàÁöÑÊó•Êúü
            const totalCells = 42;
            const cellsFilled = firstDayOfWeek + daysInMonth;
            const cellsNeeded = totalCells - cellsFilled;
            
            for (let day = 1; day <= cellsNeeded; day++) {
                const date = new Date(year, month + 1, day);
                createDayCell(date, day, true);
            }
            
            // Êõ¥Êñ∞‰ø°ÊÅØÊ†è
            updateInfo();
        }
        
        function createDayCell(date, dayNumber, isOtherMonth, isToday = false) {
            const daysGrid = document.getElementById('days-grid');
            const dayCell = document.createElement('div');
            
            dayCell.className = 'day-cell';
            const dateStr = formatDate(date);
            dayCell.dataset.date = dateStr;
            
            // Êó•ÊúüÊï∞Â≠ó
            const dayNumberSpan = document.createElement('span');
            dayNumberSpan.className = 'day-number';
            dayNumberSpan.textContent = dayNumber;
            dayCell.appendChild(dayNumberSpan);
            
            if (isOtherMonth) {
                dayCell.classList.add('other-month');
            }
            
            if (isToday) {
                dayCell.classList.add('today');
            }
            
            // Ê£ÄÊü•ÊòØÂê¶ÊòØÊúàÁªèÊúü
            const cycle = findCycleByDate(dateStr);
            if (cycle) {
                dayCell.classList.add('period');
                if (cycle.startDate === dateStr) {
                    dayCell.classList.add('period-start');
                }
            }
            
            // Ê£ÄÊü•È¢ÑÊµãÊúü
            const nextPrediction = getNextPrediction();
            if (nextPrediction && date >= nextPrediction) {
                const predictedStart = formatDate(nextPrediction);
                const predictedEnd = new Date(nextPrediction);
                predictedEnd.setDate(predictedEnd.getDate() + periodLength - 1);
                
                if (date >= nextPrediction && date <= predictedEnd) {
                    dayCell.classList.add('predicted');
                }
            }
            
            // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
            if (!isOtherMonth) {
                dayCell.addEventListener('click', function(e) {
                    e.stopPropagation();
                    handleDayClick(dateStr, dayNumber);
                });
            }
            
            daysGrid.appendChild(dayCell);
        }
        
        function formatDate(date) {
            return date.getFullYear() + '-' + 
                   (date.getMonth() + 1).toString().padStart(2, '0') + '-' + 
                   date.getDate().toString().padStart(2, '0');
        }
        
        function parseDate(dateStr) {
            const parts = dateStr.split('-').map(Number);
            return new Date(parts[0], parts[1] - 1, parts[2]);
        }
        
        // Âë®ÊúüÊìç‰Ωú
        function findCycleByDate(dateStr) {
            for (let i = 0; i < periods.length; i++) {
                if (periods[i].days.includes(dateStr)) {
                    return periods[i];
                }
            }
            return null;
        }
        
        function addCycle(startDateStr, length = periodLength) {
            const existingCycle = findCycleByDate(startDateStr);
            if (existingCycle) {
                if (confirm('Ëøô‰∏ÄÂ§©Â∑≤ÁªèÂú®‰∏Ä‰∏™Âë®Êúü‰∏≠„ÄÇË¶ÅÂêàÂπ∂ÂêóÔºü')) {
                    updateCycleLength(existingCycle.id, length);
                    return existingCycle;
                }
                return null;
            }
            
            const startDate = parseDate(startDateStr);
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + length - 1);
            
            const cycle = {
                id: Date.now(),
                startDate: startDateStr,
                endDate: formatDate(endDate),
                length: length,
                days: []
            };
            
            for (let i = 0; i < length; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                cycle.days.push(formatDate(date));
            }
            
            periods.push(cycle);
            saveData();
            return cycle;
        }
        
        function updateCycleLength(cycleId, newLength) {
            for (let i = 0; i < periods.length; i++) {
                if (periods[i].id === cycleId) {
                    const startDate = parseDate(periods[i].startDate);
                    const endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + newLength - 1);
                    
                    periods[i].endDate = formatDate(endDate);
                    periods[i].length = newLength;
                    
                    periods[i].days = [];
                    for (let j = 0; j < newLength; j++) {
                        const date = new Date(startDate);
                        date.setDate(startDate.getDate() + j);
                        periods[i].days.push(formatDate(date));
                    }
                    
                    saveData();
                    return true;
                }
            }
            return false;
        }
        
        function removeSingleDay(dateStr) {
            for (let i = 0; i < periods.length; i++) {
                const dayIndex = periods[i].days.indexOf(dateStr);
                if (dayIndex !== -1) {
                    if (periods[i].days.length === 1) {
                        periods.splice(i, 1);
                        saveData();
                        return true;
                    }
                    
                    periods[i].days.splice(dayIndex, 1);
                    
                    if (dateStr === periods[i].startDate) {
                        periods[i].startDate = periods[i].days[0];
                    }
                    
                    if (dateStr === periods[i].endDate) {
                        periods[i].endDate = periods[i].days[periods[i].days.length - 1];
                    }
                    
                    periods[i].length = periods[i].days.length;
                    saveData();
                    return true;
                }
            }
            return false;
        }
        
        function deleteCycleByDate(dateStr) {
            for (let i = 0; i < periods.length; i++) {
                if (periods[i].days.includes(dateStr)) {
                    periods.splice(i, 1);
                    saveData();
                    return true;
                }
            }
            return false;
        }
        
        // È¢ÑÊµãÂäüËÉΩ
        function calculateAverageCycle() {
            if (periods.length < 2) return 28;
            
            let totalDays = 0;
            let count = 0;
            
            const sortedPeriods = [...periods].sort((a, b) => 
                parseDate(a.startDate) - parseDate(b.startDate)
            );
            
            for (let i = 1; i < sortedPeriods.length; i++) {
                const prev = parseDate(sortedPeriods[i-1].startDate);
                const curr = parseDate(sortedPeriods[i].startDate);
                const diffDays = Math.round((curr - prev) / (1000 * 60 * 60 * 24));
                
                if (diffDays >= 20 && diffDays <= 45) {
                    totalDays += diffDays;
                    count++;
                }
            }
            
            return count > 0 ? Math.round(totalDays / count) : 28;
        }
        
        function getNextPrediction() {
            if (periods.length === 0) return null;
            
            const sortedPeriods = [...periods].sort((a, b) => 
                parseDate(b.startDate) - parseDate(a.startDate)
            );
            
            const lastPeriod = sortedPeriods[0];
            const avgCycle = calculateAverageCycle();
            const lastStart = parseDate(lastPeriod.startDate);
            
            const nextPrediction = new Date(lastStart);
            nextPrediction.setDate(lastStart.getDate() + avgCycle);
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            while (nextPrediction <= today) {
                nextPrediction.setDate(nextPrediction.getDate() + avgCycle);
            }
            
            return nextPrediction;
        }
        
        // ‰∫ã‰ª∂Â§ÑÁêÜ
        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            updateCalendar();
        }
        
        function handleDayClick(dateStr, day) {
            selectedDate = dateStr;
            selectedCycle = findCycleByDate(dateStr);
            
            const setStartOption = document.getElementById('set-start-option');
            const toggleOption = document.getElementById('toggle-single-option');
            const deleteOption = document.getElementById('delete-option');
            
            setStartOption.textContent = selectedCycle ? 
                '‰øÆÊîπÂë®ÊúüÂºÄÂßãÊó• (' + periodLength + 'Â§©Âë®Êúü)' : 
                'ËÆæ‰∏∫ÊúàÁªèÂºÄÂßãÊó• (' + periodLength + 'Â§©Âë®Êúü)';
            
            toggleOption.textContent = selectedCycle ? 
                'ÂèñÊ∂àÊ†áËÆ∞Ëøô‰∏ÄÂ§©' : 
                '‰ªÖÊ†áËÆ∞Ëøô‰∏ÄÂ§©';
            
            deleteOption.style.display = selectedCycle ? 'block' : 'none';
            
            showEditDialog(dateStr, day);
        }
        
        function showEditDialog(dateStr, day) {
            const dialog = document.getElementById('edit-dialog');
            const overlay = document.getElementById('dialog-overlay');
            const title = document.getElementById('dialog-title');
            const date = parseDate(dateStr);
            
            title.textContent = (date.getMonth() + 1) + 'Êúà' + day + 'Êó•';
            
            dialog.style.display = 'block';
            overlay.style.display = 'block';
            
            setTimeout(() => {
                dialog.classList.add('active');
            }, 10);
        }
        
        function closeDialog() {
            const dialog = document.getElementById('edit-dialog');
            const overlay = document.getElementById('dialog-overlay');
            
            dialog.classList.remove('active');
            
            setTimeout(() => {
                dialog.style.display = 'none';
                overlay.style.display = 'none';
            }, 150);
        }
        
        // ÂØπËØùÊ°ÜÊìç‰Ωú
        function setPeriodStart() {
            if (selectedCycle) {
                deleteCycleByDate(selectedDate);
            }
            
            addCycle(selectedDate, periodLength);
            closeDialog();
            updateCalendar();
            showMessage('Â∑≤ËÆæÁΩÆ‰∏∫ÊúàÁªèÂºÄÂßãÊó• (' + periodLength + 'Â§©Âë®Êúü)');
        }
        
        function toggleSingleDay() {
            if (selectedCycle) {
                const removed = removeSingleDay(selectedDate);
                if (removed) {
                    showMessage('Â∑≤ÂèñÊ∂àÊ†áËÆ∞Ëøô‰∏ÄÂ§©');
                }
            } else {
                addCycle(selectedDate, 1);
                showMessage('Â∑≤Ê†áËÆ∞Ëøô‰∏ÄÂ§©');
            }
            closeDialog();
            updateCalendar();
        }
        
        function deletePeriod() {
            if (selectedCycle && confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Êï¥‰∏™ÊúàÁªèÂë®ÊúüÂêóÔºü')) {
                deleteCycleByDate(selectedDate);
                closeDialog();
                updateCalendar();
                showMessage('Âë®ÊúüÂ∑≤Âà†Èô§');
            }
        }
        
        // Âë®ÊúüÈïøÂ∫¶Ë∞ÉÊï¥
        function showAdjustDialog() {
            const dialog = document.getElementById('adjust-dialog');
            const overlay = document.getElementById('dialog-overlay');
            
            document.getElementById('adjust-length').textContent = periodLength;
            document.getElementById('current-length').textContent = periodLength;
            
            dialog.style.display = 'block';
            overlay.style.display = 'block';
            
            setTimeout(() => {
                dialog.classList.add('active');
            }, 10);
        }
        
        function closeAdjustDialog() {
            const dialog = document.getElementById('adjust-dialog');
            const overlay = document.getElementById('dialog-overlay');
            
            dialog.classList.remove('active');
            
            setTimeout(() => {
                dialog.style.display = 'none';
                overlay.style.display = 'none';
            }, 150);
        }
        
        function changePeriodLength(delta) {
            let newLength = parseInt(document.getElementById('adjust-length').textContent) + delta;
            if (newLength >= 3 && newLength <= 14) {
                document.getElementById('adjust-length').textContent = newLength;
            }
        }
        
        function savePeriodLength() {
            const newLength = parseInt(document.getElementById('adjust-length').textContent);
            
            if (periods.length > 0 && confirm('ÊòØÂê¶Êõ¥Êñ∞ÊâÄÊúâÁé∞ÊúâÂë®ÊúüÁöÑÈïøÂ∫¶Ôºü')) {
                for (let i = 0; i < periods.length; i++) {
                    updateCycleLength(periods[i].id, newLength);
                }
            }
            
            periodLength = newLength;
            document.getElementById('period-length').textContent = newLength;
            saveData();
            
            closeAdjustDialog();
            updateCalendar();
            showMessage('ÁªèÊúüÈïøÂ∫¶Â∑≤ËÆæÁΩÆ‰∏∫ ' + newLength + ' Â§©');
        }
        
        // ËæÖÂä©ÂáΩÊï∞
        function updateInfo() {
            document.getElementById('record-count').textContent = periods.length;
            document.getElementById('avg-cycle').textContent = calculateAverageCycle();
            document.getElementById('period-length').textContent = periodLength;
        }
        
        function showMessage(message) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 2000);
        }
    </script>

</body></html>